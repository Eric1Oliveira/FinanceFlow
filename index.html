<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Finance Flow</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.ico">
 </head>
 <body class="h-full">
  <!-- Tela de Login/Cadastro -->
  <div id="authContainer" class="fixed inset-0 flex items-center justify-center z-50 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 overflow-hidden">
    <!-- Elementos decorativos de fundo -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-emerald-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
      <div class="absolute top-1/2 left-1/2 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>
    </div>

    <div class="w-full max-w-md mx-4 relative z-10">
      <!-- Login Form -->
      <div id="loginForm" class="rounded-3xl p-8 backdrop-blur-xl bg-white/10 border border-white/20 shadow-2xl transform transition-all duration-500 hover:shadow-2xl hover:shadow-emerald-500/20">
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-emerald-400 to-emerald-600 mb-6 shadow-lg">
            <svg width="32" height="32" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white"><rect x="4" y="4" width="24" height="24" rx="4" stroke="currentColor" stroke-width="2" /> <path d="M16 10V22M10 16H22" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </div>
          <h2 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-emerald-600">Finance Flow</h2>
          <p class="mt-3 text-gray-300 font-medium">Bem-vindo de volta</p>
        </div>

        <form onsubmit="handleLogin(event)" class="space-y-5">
          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Email</label>
            <input type="email" id="loginEmail" required placeholder="seu@email.com" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-emerald-400 focus:bg-white/10 focus:ring-2 focus:ring-emerald-400/20 transition-all text-white placeholder-gray-500">
          </div>

          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Senha</label>
            <input type="password" id="loginPassword" required placeholder="••••••••" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-emerald-400 focus:bg-white/10 focus:ring-2 focus:ring-emerald-400/20 transition-all text-white placeholder-gray-500">
          </div>

          <button type="submit" class="w-full bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 text-white font-bold py-3.5 rounded-xl transition-all duration-300 mt-8 shadow-lg hover:shadow-emerald-500/50 transform hover:scale-105 active:scale-95">Entrar</button>
        </form>

        <div class="flex items-center gap-3 my-6 opacity-50">
          <div class="flex-1 h-px bg-white/20"></div>
          <span class="text-sm text-gray-400">ou</span>
          <div class="flex-1 h-px bg-white/20"></div>
        </div>

        <p class="text-center text-gray-300">Não tem conta? <button type="button" onclick="toggleAuthForm()" class="font-semibold text-emerald-400 hover:text-emerald-300 transition-colors">Cadastre-se aqui</button></p>
      </div>

      <!-- Signup Form -->
      <div id="signupForm" class="rounded-3xl p-8 backdrop-blur-xl bg-white/10 border border-white/20 shadow-2xl transform transition-all duration-500 hover:shadow-2xl hover:shadow-blue-500/20 hidden">
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 mb-6 shadow-lg">
            <svg width="32" height="32" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white"><path d="M16 8C19.3137 8 22 10.6863 22 14C22 17.3137 19.3137 20 16 20C12.6863 20 10 17.3137 10 14C10 10.6863 12.6863 8 16 8ZM16 22C18.7614 22 21 24.2386 21 27H11C11 24.2386 13.2386 22 16 22Z" fill="currentColor" />
            </svg>
          </div>
          <h2 class="text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-blue-600">Criar Conta</h2>
          <p class="mt-3 text-gray-300 font-medium">Comece a controlar suas finanças</p>
        </div>

        <form onsubmit="handleSignup(event)" class="space-y-5">
          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Nome Completo</label>
            <input type="text" id="signupName" required placeholder="Seu Nome" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-blue-400 focus:bg-white/10 focus:ring-2 focus:ring-blue-400/20 transition-all text-white placeholder-gray-500">
          </div>

          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Email</label>
            <input type="email" id="signupEmail" required placeholder="seu@email.com" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-blue-400 focus:bg-white/10 focus:ring-2 focus:ring-blue-400/20 transition-all text-white placeholder-gray-500">
          </div>

          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Senha</label>
            <input type="password" id="signupPassword" required placeholder="••••••••" minlength="6" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-blue-400 focus:bg-white/10 focus:ring-2 focus:ring-blue-400/20 transition-all text-white placeholder-gray-500">
            <p class="text-xs text-gray-400 mt-2 flex items-center gap-2"><span class="inline-block w-1 h-1 bg-emerald-400 rounded-full"></span>Mínimo 6 caracteres</p>
          </div>

          <div class="group">
            <label class="block text-sm font-semibold mb-3 text-gray-200">Confirmar Senha</label>
            <input type="password" id="signupPasswordConfirm" required placeholder="••••••••" minlength="6" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3.5 focus:outline-none focus:border-blue-400 focus:bg-white/10 focus:ring-2 focus:ring-blue-400/20 transition-all text-white placeholder-gray-500">
          </div>

          <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 text-white font-bold py-3.5 rounded-xl transition-all duration-300 mt-8 shadow-lg hover:shadow-blue-500/50 transform hover:scale-105 active:scale-95">Criar Conta</button>
        </form>

        <div class="flex items-center gap-3 my-6 opacity-50">
          <div class="flex-1 h-px bg-white/20"></div>
          <span class="text-sm text-gray-400">ou</span>
          <div class="flex-1 h-px bg-white/20"></div>
        </div>

        <p class="text-center text-gray-300">Já tem conta? <button type="button" onclick="toggleAuthForm()" class="font-semibold text-blue-400 hover:text-blue-300 transition-colors">Entrar aqui</button></p>
      </div>
    </div>
  </div>

  <!-- Aplicação Principal -->
  <div id="app" class="h-full w-full hidden"><!-- Sidebar -->
   <aside class="sidebar" id="sidebar">
    <div class="p-6 border-b border-gray-800">
     <div class="flex items-center gap-3">
      <svg width="32" height="32" viewbox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4" y="4" width="24" height="24" rx="4" stroke="#10b981" stroke-width="2" /> <path d="M16 10V22M10 16H22" stroke="#10b981" stroke-width="2" stroke-linecap="round" />
      </svg>
      <h1 class="text-xl font-bold">FinanceFlow</h1>
     </div>
    </div>
    <nav class="py-4 flex-1">
     <div class="sidebar-item" onclick="navigateTo('dashboard')" data-page="0">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="2" y="11" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="11" y="2" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="11" y="11" width="7" height="7" rx="1" stroke="currentColor" stroke-width="1.5" />
      </svg><span class="font-semibold">Dashboard</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('transactions')" data-page="1">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H16M4 10H16M4 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      </svg><span class="font-semibold">Transações</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('recurring')" data-page="2">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 10C4 6.686 6.686 4 10 4C13.314 4 16 6.686 16 10C16 13.314 13.314 16 10 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" /> <path d="M10 4V2M10 4L8 6M10 4L12 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" /> <path d="M4 14L6 12M4 14L6 16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg><span class="font-semibold">Recorrentes</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('categories')" data-page="3">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="12" y="2" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="2" y="12" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" /> <rect x="12" y="12" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5" />
      </svg><span class="font-semibold">Categorias</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('cards')" data-page="4">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="4" width="16" height="12" rx="2" stroke="currentColor" stroke-width="1.5" /> <path d="M2 8H18" stroke="currentColor" stroke-width="1.5" /> <circle cx="5" cy="12" r="0.5" fill="currentColor" />
      </svg><span class="font-semibold">Carteira</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('goals')" data-page="5">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5" /> <circle cx="10" cy="10" r="4" stroke="currentColor" stroke-width="1.5" /> <circle cx="10" cy="10" r="1" fill="currentColor" />
      </svg><span class="font-semibold">Metas</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('simulator')" data-page="6">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 6H16M4 10H16M4 14H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" /> <circle cx="15" cy="15" r="4" fill="none" stroke="currentColor" stroke-width="1.5" /> <path d="M15 12V15M15 15H18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg><span class="font-semibold">Simulador</span>
     </div>
     <div class="sidebar-item achievements-menu-item" onclick="navigateTo('achievements')" data-page="7">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 2L12 7H17L13 10.5L15 16L10 12L5 16L7 10.5L3 7H8L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" />
      </svg><span class="font-semibold">Conquistas</span>
     </div>
     <div class="sidebar-item" onclick="navigateTo('settings')" data-page="8">
      <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="10" cy="10" r="3" stroke="currentColor" stroke-width="1.5" /> <path d="M10 2V4M10 16V18M18 10H16M4 10H2M15.5 4.5L14 6M6 14L4.5 15.5M15.5 15.5L14 14M6 6L4.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" />
      </svg><span class="font-semibold">Configurações</span>
     </div>
    </nav><!-- User Profile Section -->
    <div class="p-4 border-t border-gray-800 mt-auto">
     <div class="flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center flex-shrink-0">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" fill="#000" /> <path d="M6 21C6 17.134 8.686 14 12 14C15.314 14 18 17.134 18 21" stroke="#000" stroke-width="2" stroke-linecap="round" />
       </svg>
      </div>
      <div class="flex-1 min-w-0">
       <p id="userProfileName" class="font-bold text-sm truncate">Usuário</p>
       <div class="flex items-center gap-2 mt-1 xp-section">
        <div class="relative" style="width: 24px; height: 24px;">
         <svg class="absolute inset-0" width="24" height="24" viewbox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="#1a1a1a" stroke-width="2" /> <circle id="xpCircleMini" cx="12" cy="12" r="10" fill="none" stroke="url(#gradientMini)" stroke-width="2" stroke-linecap="round" stroke-dasharray="62.8" stroke-dashoffset="62.8" transform="rotate(-90 12 12)" style="transition: stroke-dashoffset 0.5s ease;" /> <defs>
           <lineargradient id="gradientMini" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#059669;stop-opacity:1" />
           </lineargradient>
          </defs>
         </svg>
         <div class="absolute inset-0 flex items-center justify-center"><span class="text-[10px] font-bold text-green-500" id="levelNumberMini">1</span>
         </div>
        </div>
        <div class="text-xs text-gray-400"><span class="text-green-500 font-semibold"><span id="currentXPMini">0</span>/<span id="nextLevelXPMini">100</span></span> XP
        </div>
       </div>
      </div>
      <button onclick="handleLogout()" class="p-2 hover:bg-gray-800 rounded-lg transition-colors flex-shrink-0" title="Sair">
       <svg width="20" height="20" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 21H5C4.44772 21 4 20.5523 4 20V4C4 3.44772 4.44772 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
      </button>
     </div>
    </div>
   </aside><!-- Mobile Menu Toggle Button -->
   <button id="mobileMenuToggle" class="mobile-menu-toggle" onclick="toggleMobileMenu()" title="Abrir menu">
    <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="menu-icon">
     <path d="M3 6H21M3 12H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
    <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="close-icon" style="display: none; position: absolute;">
     <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
   </button>
   <!-- Overlay para fechar menu ao clicar fora -->
   <div id="mobileMenuOverlay" class="mobile-menu-overlay" onclick="closeMobileMenu()"></div><!-- Main Content -->
   <main class="main-content"><!-- Dashboard Page -->
    <div id="dashboardPage" class="page active">
     <div class="p-6">
      <div class="flex flex-col md:flex-row items-center justify-center md:justify-between mb-6 gap-4">
       <div class="flex items-center justify-between gap-4 order-2 md:order-1 w-full md:w-auto">
        <h2 class="text-3xl font-bold">Dashboard</h2>
        <div class="flex items-center gap-2 md:hidden"><button class="btn-primary" style="width: auto;" onclick="openTransactionModal()">
          <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg> Nova Transação </button>
        </div>
       </div>
       <div class="relative order-1 md:order-2 w-full md:w-auto">
        <div class="flex items-center justify-between gap-0 rounded-xl px-5 py-3 shadow-xl transition-all month-selector"><button onclick="changeMonth(-1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 4L7 9L11 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
         <div class="text-center flex-1">
          <p id="currentMonthLabel" class="text-sm font-bold month-label"></p>
         </div><button onclick="changeMonth(1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 4L11 9L7 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
        </div><button id="backToCurrentBtn" onclick="backToCurrentMonth()" class="absolute left-1/2 -translate-x-1/2 text-xs bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-full transition-all flex items-center shadow-lg hover:shadow-green-900 hover:scale-105 z-10" style="display: none; top: calc(100% + 2px);"> Hoje </button>
       </div>
       <div class="hidden md:flex items-center gap-2 order-3"><button class="btn-primary" style="width: auto;" onclick="openTransactionModal()">
         <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
         </svg> Nova Transação </button>
       </div>
      </div><!-- Stats Grid -->
      <div class="stats-grid mb-6">
       <div class="stat-card cursor-pointer hover:opacity-80 transition-opacity" onclick="openAdjustBalanceModal()">
        <div class="flex items-center justify-between mb-2"><span class="text-gray-400 text-sm">Saldo Total</span>
         <div class="flex items-center gap-2">
          <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="6" width="18" height="13" rx="2" stroke="#10b981" stroke-width="2" /> <path d="M3 10H21" stroke="#10b981" stroke-width="2" /> <circle cx="7" cy="14" r="1" fill="#10b981" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500 hover:text-green-500"><path d="M12 20h9"/><path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
         </div>
        </div>
        <p id="totalBalance" class="text-3xl font-bold text-green-500">R$ 0,00</p>
       </div>
       <div class="stat-card">
        <div class="flex items-center justify-between mb-2"><span class="text-gray-400 text-sm">Receitas (mês)</span>
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 19V5M12 5L5 12M12 5L19 12" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg>
        </div>
        <p id="monthIncome" class="text-3xl font-bold text-green-500">R$ 0,00</p>
       </div>
       <div class="stat-card">
        <div class="flex items-center justify-between mb-2"><span class="text-gray-400 text-sm">Despesas (mês)</span>
         <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M12 19L19 12M12 19L5 12" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
         </svg>
        </div>
        <p id="monthExpenses" class="text-3xl font-bold text-red-500">R$ 0,00</p>
       </div>
      </div><!-- Charts -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
       <div class="chart-container">
        <h3 class="text-xl font-bold mb-4">Despesas por Categoria</h3>
        <div id="categoryChart"></div>
       </div>
       <div class="chart-container">
        <h3 class="text-xl font-bold mb-4">Últimas Transações</h3>
        <div id="recentTransactions"></div>
       </div>
      </div><!-- Goals Preview -->
      <div class="chart-container">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Minhas Metas</h3><button class="text-green-500 hover:text-green-400 text-sm font-semibold" onclick="navigateTo('goals')">Ver todas →</button>
       </div>
       <div id="goalsPreview"></div>
      </div>
     </div>
    </div><!-- Transactions Page -->
    <div id="transactionsPage" class="page">
     <div class="p-6">
      <div class="flex flex-col md:flex-row items-center justify-center md:justify-between mb-6 gap-4">
       <div class="flex items-center justify-between gap-4 order-2 md:order-1 w-full md:w-auto">
        <h2 class="text-3xl font-bold">Transações</h2>
        <div class="flex items-center gap-2 md:hidden"><button class="btn-primary" style="width: auto;" onclick="openTransactionModal()">
          <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg> Nova Transação </button>
        </div>
       </div>
       <div class="relative order-1 md:order-2 w-full md:w-auto">
        <div class="flex items-center justify-between gap-0 rounded-xl px-5 py-3 shadow-xl transition-all month-selector"><button onclick="changeMonth(-1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 4L7 9L11 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
         <div class="text-center flex-1">
          <p id="transactionsMonthLabel" class="text-sm font-bold month-label"></p>
         </div><button onclick="changeMonth(1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 4L11 9L7 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
        </div><button id="backToCurrentBtn2" onclick="backToCurrentMonth()" class="absolute left-1/2 -translate-x-1/2 text-xs bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-full transition-all flex items-center shadow-lg hover:shadow-green-900 hover:scale-105 z-10" style="display: none; top: calc(100% + 2px);"> Hoje </button>
       </div>
       <div class="hidden md:flex items-center gap-2 order-3"><button class="btn-primary" style="width: auto;" onclick="openTransactionModal()">
         <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
         </svg> Nova Transação </button>
       </div>
      </div>
      <div class="mb-4 flex gap-2"><button class="btn-secondary text-sm" style="width: auto;" onclick="filterTransactions('all')">Todas</button> <button class="btn-secondary text-sm" style="width: auto;" onclick="filterTransactions('receita')">Receitas</button> <button class="btn-secondary text-sm" style="width: auto;" onclick="filterTransactions('despesa')">Despesas</button>
      </div>
      <div id="transactionsList"></div>
     </div>
    </div><!-- Recurring Transactions Page -->
    <div id="recurringPage" class="page">
     <div class="p-6" style="padding-top: 100px;">
      <div class="flex flex-row items-center justify-between gap-4 mb-6">
       <h2 class="text-3xl font-bold">Transações Recorrentes</h2><button class="btn-primary" style="width: auto;" onclick="openRecurringModal()">
        <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg> Nova Recorrência </button>
      </div>
      <div class="mb-4 flex gap-2"><button class="btn-secondary text-sm" style="width: auto;" onclick="filterRecurring('all')">Todas</button> <button class="btn-secondary text-sm" style="width: auto;" onclick="filterRecurring('permanent')">Permanentes</button> <button class="btn-secondary text-sm" style="width: auto;" onclick="filterRecurring('temporary')">Temporárias</button>
      </div>
      <div id="recurringList"></div>
     </div>
    </div><!-- Cards Page -->
    <div id="cardsPage" class="page">
     <div class="p-6">
      <div class="flex flex-col md:flex-row items-center justify-center md:justify-between mb-6 gap-4">
       <div class="flex items-center justify-between gap-4 order-2 md:order-1 w-full md:w-auto">
        <h2 class="text-3xl font-bold">Cartões</h2>
        <div class="flex items-center gap-2 md:hidden"><button class="btn-primary" style="width: auto;" onclick="openCardModal()">
          <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg> Novo Cartão </button>
        </div>
       </div>
       <div class="relative order-1 md:order-2 w-full md:w-auto">
        <div class="flex items-center justify-between gap-0 rounded-xl px-5 py-3 shadow-xl transition-all month-selector"><button onclick="changeCardViewMonth(-1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 4L7 9L11 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
         <div class="text-center flex-1">
          <p id="cardViewMonthLabel" class="text-sm font-bold month-label"></p>
         </div><button onclick="changeCardViewMonth(1)" class="text-gray-400 hover:text-green-400 transition-all p-2 hover:bg-green-900 hover:bg-opacity-30 rounded-lg flex-shrink-0">
          <svg width="18" height="18" viewbox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 4L11 9L7 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg></button>
        </div><button id="backToCurrentCardBtn" onclick="backToCurrentCardMonth()" class="absolute left-1/2 -translate-x-1/2 text-xs bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-full transition-all flex items-center shadow-lg hover:shadow-green-900 hover:scale-105 z-10" style="display: none; top: calc(100% + 2px);"> Hoje </button>
       </div>
       <div class="hidden md:flex items-center gap-2 order-3"><button class="btn-primary" style="width: auto;" onclick="openCardModal()">
         <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
         </svg> Novo Cartão </button>
       </div>
      </div>
      <div id="cardsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
     </div>
    </div><!-- Categories Page -->
    <div id="categoriesPage" class="page">
     <div class="p-6">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-3xl font-bold">Categorias</h2><button class="btn-primary" style="width: auto;" onclick="openCategoryModal()">
        <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg> Nova Categoria </button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="categoriesList"></div>
     </div>
    </div><!-- Goals Page -->
    <div id="goalsPage" class="page">
     <div class="p-6" style="padding-top: 100px;">
      <div class="flex flex-row items-center justify-between gap-4 mb-6">
       <h2 class="text-3xl font-bold">Metas Financeiras</h2><button class="btn-primary" style="width: auto;" onclick="openGoalModal()">
        <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg> Nova Meta </button>
      </div>
      <div id="goalsList"></div>
     </div>
    </div><!-- Simulator Page -->
    <div id="simulatorPage" class="page">
     <div class="p-6">
      <h2 class="text-3xl font-bold mb-6">Simulador de Investimentos</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
       <!-- Formulário de Simulação -->
       <div class="stat-card">
        <h3 class="text-xl font-bold mb-4">Simular Investimento</h3>
        <div class="space-y-4">
         <div>
          <label class="block text-sm font-semibold mb-2">Valor Inicial (R$)</label>
          <input type="number" id="simulatorInitialValue" step="0.01" placeholder="1.000,00" oninput="calculateSimulationRealtime()" onchange="calculateSimulationRealtime()" class="w-full">
         </div>
         <div>
          <label class="block text-sm font-semibold mb-2">Tipo de Rendimento</label>
          <select id="simulatorRateType" onchange="calculateSimulationRealtime()" class="w-full">
           <option value="FIXED">Taxa Fixa ao Mês (%)</option>
           <option value="CDI">Percentual do CDI</option>
          </select>
         </div>
         <div id="bankSelectionDiv">
          <label class="block text-sm font-semibold mb-2">Instituição Financeira (Opcional)</label>
          <select id="simulatorBank" onchange="calculateSimulationRealtime()" class="w-full">
           <option value="">-- Personalizado --</option>
          </select>
         </div>
         <div>
          <label class="block text-sm font-semibold mb-2">Taxa/Percentual</label>
          <input type="number" id="simulatorInterestRate" step="0.01" placeholder="0,50" oninput="calculateSimulationRealtime()" onchange="calculateSimulationRealtime()" class="w-full">
         </div>
         <div class="grid grid-cols-2 gap-4">
          <div>
           <label class="block text-sm font-semibold mb-2">Mês Inicial</label>
           <input type="month" id="simulatorStartMonth" oninput="calculateSimulationRealtime()" onchange="calculateSimulationRealtime()" class="w-full">
          </div>
          <div>
           <label class="block text-sm font-semibold mb-2">Mês Final</label>
           <input type="month" id="simulatorEndMonth" oninput="calculateSimulationRealtime()" onchange="calculateSimulationRealtime()" class="w-full">
          </div>
         </div>
        </div>
       </div>
       <!-- Resultado da Simulação -->
       <div class="stat-card">
        <h3 class="text-xl font-bold mb-4">Resultado</h3>
        <div class="space-y-4">
         <div>
          <p class="text-sm text-gray-400 mb-1">Valor Inicial</p>
          <p class="text-2xl font-bold text-gray-300">R$ <span id="resultInitialValue">0,00</span></p>
         </div>
         <div>
          <p class="text-sm text-gray-400 mb-1">Juros Ganhos</p>
          <p class="text-2xl font-bold text-green-500">R$ <span id="resultInterest">0,00</span></p>
         </div>
         <div>
          <p class="text-sm text-gray-400 mb-1">Rentabilidade</p>
          <p class="text-lg font-bold text-blue-500"><span id="resultRentability">0,00</span>%</p>
         </div>
         <div class="border-t border-gray-700 pt-4">
          <p class="text-sm text-gray-400 mb-1">Valor Final</p>
          <p class="text-3xl font-bold text-green-500">R$ <span id="resultFinalValue">0,00</span></p>
         </div>
         <div>
          <p class="text-sm text-gray-400 mb-1">Valor Mensal</p>
          <p class="text-2xl font-bold text-green-400"><span id="resultMonthlyValue">0,00</span></p>
         </div>
         <div>
          <p class="text-sm text-gray-400 mb-1">Período</p>
          <p class="text-lg font-semibold text-gray-300"><span id="resultMonths">0</span> períodos</p>
         </div>
        </div>
       </div>
      </div>
      <!-- Gráfico de Simulação -->
      <div class="stat-card mt-6">
       <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">Evolução do Investimento</h3>
        <div class="flex gap-2">
         <button onclick="changeChartGranularity('day')" id="filterDay" class="px-3 py-1 rounded-lg text-sm font-semibold transition-all border">Dia</button>
         <button onclick="changeChartGranularity('month')" id="filterMonth" class="px-3 py-1 rounded-lg text-sm font-semibold transition-all border active-filter">Mês</button>
         <button onclick="changeChartGranularity('year')" id="filterYear" class="px-3 py-1 rounded-lg text-sm font-semibold transition-all border">Ano</button>
        </div>
       </div>
       <div id="simulationChart"></div>
      </div>
     </div>
    </div><!-- Achievements Page -->
    <div id="achievementsPage" class="page">
     <div class="p-6">
      <h2 class="text-3xl font-bold mb-6">Conquistas</h2>
      <div id="achievementsList"></div>
     </div>
    </div><!-- Settings Page -->
    <div id="settingsPage" class="page">
     <div class="p-6 max-w-4xl mx-auto">
      <div class="mb-8">
       <div class="flex items-center gap-3 mb-2">
        <svg class="w-8 h-8 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"></circle><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"></path></svg>
        <h2 class="text-3xl font-bold">Configurações</h2>
       </div>
       <p class="text-gray-400 text-sm">Personalize sua experiência no FinanceFlow</p>
      </div>
      
      <!-- Tema -->
      <div class="stat-card mb-6">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-blue-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        <div>
         <h3 class="text-lg font-bold">Aparência</h3>
         <p class="text-xs text-gray-400">Escolha o tema visual</p>
        </div>
       </div>
       <div class="space-y-3">
        <div class="grid grid-cols-2 gap-3">
         <button class="py-4 px-4 rounded-lg font-semibold transition-all border-2" id="themeDarkBtn" onclick="setTheme('dark')" style="border-color: var(--primary-color, #3b82f6);">
          <div class="flex justify-center mb-2">
           <svg class="w-6 h-6 text-gray-300" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
          </div>
          <div class="font-semibold text-sm">Escuro</div>
          <div class="text-xs text-gray-400 mt-1">Tema noturno</div>
         </button>
        </div>
       </div>
      </div>

      <!-- Perfil -->
      <div class="stat-card mb-6">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-green-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        <div>
         <h3 class="text-lg font-bold">Perfil</h3>
         <p class="text-xs text-gray-400">Informações da sua conta</p>
        </div>
       </div>
       <div class="space-y-4">
        <div>
         <label class="block text-sm font-semibold mb-2 flex items-center gap-2">
          <svg class="w-4 h-4 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          Nome de Usuário
         </label>
         <input type="text" id="settingsUsername" placeholder="Seu nome" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-blue-500 focus:outline-none transition-colors">
        </div>
        <div class="flex gap-3">
         <button class="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors" onclick="updateUserProfile()">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
          Salvar
         </button>
         <button class="flex-1 flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors" onclick="changePassword()">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
          Senha
         </button>
        </div>
       </div>
      </div>

      <!-- Preferências -->
      <div class="stat-card mb-6">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-purple-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
        <div>
         <h3 class="text-lg font-bold">Notificações</h3>
         <p class="text-xs text-gray-400">Gerencie seus alertas</p>
        </div>
       </div>
       <div class="space-y-3">
        <div class="flex items-center justify-between p-4 bg-gray-700 bg-opacity-20 rounded-lg border border-gray-700 hover:border-purple-500 hover:bg-opacity-30 transition-all">
         <div class="flex items-center gap-3">
          <svg class="w-5 h-5 text-purple-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
          <div>
           <div class="font-semibold text-sm">Ativar Notificações</div>
           <p class="text-xs text-gray-400">Receba avisos de transações e metas</p>
          </div>
         </div>
         <input type="checkbox" id="notifications" checked class="w-5 h-5 cursor-pointer rounded accent-blue-500" onchange="savePreference('notifications', this.checked)">
        </div>
       </div>
      </div>

      <!-- Dados -->
      <div class="stat-card mb-6">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-yellow-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        <div>
         <h3 class="text-lg font-bold">Dados</h3>
         <p class="text-xs text-gray-400">Importe, exporte ou remova seus dados</p>
        </div>
       </div>
       <div class="space-y-3">
        <div class="bg-blue-900 bg-opacity-20 border border-blue-600 border-opacity-50 rounded-lg p-4 flex gap-3">
         <svg class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
         <p class="text-sm text-blue-300">Recomendamos exportar seus dados regularmente para manter um backup seguro</p>
        </div>
        <button class="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors" onclick="exportData()">
         <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
         Exportar Dados (JSON)
        </button>
        <button class="w-full flex items-center justify-center gap-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors" onclick="confirmDeleteAllData()">
         <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
         Limpar TODOS os Dados
        </button>
        <p class="text-xs text-red-400 text-center font-semibold">⚠️ Esta ação é irreversível</p>
       </div>
      </div>

      <!-- Estatísticas -->
      <div class="stat-card mb-6">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-cyan-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="2" x2="12" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
        <div>
         <h3 class="text-lg font-bold">Estatísticas</h3>
         <p class="text-xs text-gray-400">Resumo da sua atividade</p>
        </div>
        <span class="text-xs bg-gray-600 bg-opacity-50 text-gray-300 px-3 py-1 rounded-full ml-auto">v1.0.0</span>
       </div>
       <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
        <div class="bg-gradient-to-br from-blue-600 to-blue-700 bg-opacity-20 rounded-lg p-4 border border-blue-600 border-opacity-30">
         <div class="text-xs text-blue-400 mb-1">Transações</div>
         <div class="text-2xl font-bold text-blue-300" id="statsTransactions">0</div>
        </div>
        <div class="bg-gradient-to-br from-green-600 to-green-700 bg-opacity-20 rounded-lg p-4 border border-green-600 border-opacity-30">
         <div class="text-xs text-green-400 mb-1">Cartões</div>
         <div class="text-2xl font-bold text-green-300" id="statsCards">0</div>
        </div>
        <div class="bg-gradient-to-br from-yellow-600 to-yellow-700 bg-opacity-20 rounded-lg p-4 border border-yellow-600 border-opacity-30">
         <div class="text-xs text-yellow-400 mb-1">Metas</div>
         <div class="text-2xl font-bold text-yellow-300" id="statsGoals">0</div>
        </div>
        <div class="bg-gradient-to-br from-purple-600 to-purple-700 bg-opacity-20 rounded-lg p-4 border border-purple-600 border-opacity-30">
         <div class="text-xs text-purple-400 mb-1">Recorrências</div>
         <div class="text-2xl font-bold text-purple-300" id="statsRecurring">0</div>
        </div>
       </div>
      </div>

      <!-- Segurança -->
      <div class="stat-card">
       <div class="flex items-center gap-3 mb-4">
        <svg class="w-6 h-6 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
        <div>
         <h3 class="text-lg font-bold">Segurança</h3>
         <p class="text-xs text-gray-400">Gerenciar sua conta</p>
        </div>
       </div>
       <div class="space-y-3">
        <button class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-gray-200 font-semibold py-3 px-4 rounded-lg transition-all border border-gray-700" onclick="changePassword()">
         <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
         Alterar Senha
        </button>
        <button class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-red-700 to-red-800 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-4 rounded-lg transition-all border border-red-700" onclick="logout()">
         <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
         Sair da Conta
        </button>
       </div>
      </div>
     </div>
    </div>
   </main><!-- Unique FAB Button - Nova Transação -->
   <button id="fabButton" class="fixed bottom-5 right-5 w-14 h-14 rounded-full bg-gradient-to-br from-green-500 to-green-600 text-white shadow-lg hover:shadow-2xl transition-all duration-300 hover:scale-110 active:scale-95 flex items-center justify-center md:hidden z-40" onclick="openTransactionModal()" title="Nova Transação">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"></line>
      <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
   </button><!-- Transaction Modal -->
   <div id="transactionModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Nova Transação</h3><button onclick="closeTransactionModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="transactionForm" onsubmit="saveTransaction(event)">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-3">Tipo</label>
        <div class="flex gap-3"><button type="button" id="btnReceita" onclick="selectTransactionType('receita')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-transaction-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15V5M10 5L5 10M10 5L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Receita </button> <button type="button" id="btnDespesa" onclick="selectTransactionType('despesa')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-transaction-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M10 15L15 10M10 15L5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Despesa </button>
        </div><input type="hidden" id="transactionType" name="type" value="receita" required>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Descrição</label>
        <div class="relative">
         <input type="text" id="transactionDescription" name="description" required placeholder="Ex: Salário, Aluguel, Compras" autocomplete="off" oninput="handleDescriptionInput(event)" onkeydown="handleDescriptionKeydown(event)" ontouchstart="setTouchStartX(event)">
         <div id="descriptionSuggestion" class="absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-green-600 rounded-lg px-3 py-2 text-sm text-gray-400 cursor-pointer hover:bg-gray-700 transition-colors hidden" onclick="acceptSuggestion()">
          <span id="suggestionText"></span>
         </div>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Valor</label>
        <div class="flex items-center gap-2"><span class="text-green-500 font-bold text-lg flex-shrink-0">R$</span> <input type="number" id="transactionAmount" name="amount" step="0.01" required placeholder="0,00" class="flex-1"> <button type="button" onclick="openCalculator()" class="text-green-500 hover:text-green-400 transition flex-shrink-0">
          <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="2" width="18" height="20" rx="2" stroke="currentColor" stroke-width="1.5" /> <path d="M3 7H21" stroke="currentColor" stroke-width="1.5" /> <circle cx="8" cy="11" r="0.75" fill="currentColor" /> <circle cx="12" cy="11" r="0.75" fill="currentColor" /> <circle cx="16" cy="11" r="0.75" fill="currentColor" /> <circle cx="8" cy="15" r="0.75" fill="currentColor" /> <circle cx="12" cy="15" r="0.75" fill="currentColor" /> <circle cx="16" cy="15" r="0.75" fill="currentColor" /> <circle cx="8" cy="19" r="0.75" fill="currentColor" /> <circle cx="12" cy="19" r="0.75" fill="currentColor" /> <circle cx="16" cy="19" r="0.75" fill="currentColor" />
          </svg></button>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Categoria</label>
        <div class="flex gap-2"><select id="transactionCategory" name="category" required class="flex-1"> </select> <button type="button" onclick="openCategoryModalFromTransaction()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar nova categoria">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Data</label> <input type="date" id="transactionDate" name="date" required>
       </div>
       <div id="cardSelectionSectionIncome" style="display: none;"><label class="block text-sm font-semibold mb-2">Depositar em (Opcional)</label>
        <div class="flex gap-2"><select id="cardSelectionIncome" name="card_id_income" class="flex-1"> <option value="">Selecione um cartão</option> </select> <button type="button" onclick="openCardModalFromTransaction()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="cardSelectionSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Selecione o Cartão</label>
        <div class="flex gap-2"><select id="cardSelection" name="card_id" class="flex-1"> <option value="">Selecione um cartão</option> </select> <button type="button" onclick="openCardModalFromTransaction()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="installmentsSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Parcelamento</label> <select id="installments" name="installments" onchange="updateInstallmentSimulation()"> <option value="1">À vista</option> <option value="2">2x</option> <option value="3">3x</option> <option value="4">4x</option> <option value="5">5x</option> <option value="6">6x</option> <option value="7">7x</option> <option value="8">8x</option> <option value="9">9x</option> <option value="10">10x</option> <option value="11">11x</option> <option value="12">12x</option> </select>
        <div id="installmentSimulation" style="display: none; margin-top: 16px;">
         <div class="installment-simulation-box">
          <div class="flex items-center justify-between mb-3">
           <h4 class="text-sm font-bold installment-title">💰 Simulação</h4><label class="flex items-center gap-2 cursor-pointer"> <input type="checkbox" id="enableInterest" onchange="updateInstallmentSimulation()" class="w-4 h-4 rounded installment-checkbox"> <span class="text-xs installment-label">Aplicar Juros</span> </label>
          </div>
          <div id="interestRateSection" style="display: none; margin-bottom: 12px;"><label class="block text-xs font-semibold mb-2 text-gray-300">Taxa de Juros (% ao mês)</label> <input type="number" id="interestRate" step="0.01" value="2.50" placeholder="2.50" onchange="updateInstallmentSimulation()" onfocus="updateInstallmentSimulation()" oninput="updateInstallmentSimulation()" class="w-full text-sm">
          </div>
          <div class="space-y-2">
           <div class="flex items-center justify-between text-sm"><span class="text-gray-400">Valor da parcela:</span> <span id="installmentValue" class="font-bold text-green-500">R$ 0,00</span>
           </div>
           <div id="totalWithInterestSection" style="display: none;">
            <div class="flex items-center justify-between text-sm"><span class="text-gray-400">Total com juros:</span> <span id="totalWithInterest" class="font-bold text-yellow-500">R$ 0,00</span>
            </div>
            <div class="flex items-center justify-between text-xs mt-1"><span class="text-gray-500">Juros totais:</span> <span id="totalInterest" class="font-semibold text-red-400">R$ 0,00</span>
            </div>
           </div>
          </div>
          <div id="installmentSchedule" class="mt-3 pt-3 border-t border-gray-700" style="max-height: 200px; overflow-y: auto;">
          </div>
         </div>
        </div>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeTransactionModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Edit Transaction Modal -->
   <div id="editTransactionModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Editar Transação</h3><button onclick="closeEditTransactionModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="editTransactionForm" onsubmit="saveEditTransaction(event)">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-3">Tipo</label>
        <div class="flex gap-3"><button type="button" id="editBtnReceita" onclick="selectEditTransactionType('receita')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-transaction-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15V5M10 5L5 10M10 5L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Receita </button> <button type="button" id="editBtnDespesa" onclick="selectEditTransactionType('despesa')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-transaction-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M10 15L15 10M10 15L5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Despesa </button>
        </div><input type="hidden" id="editTransactionType" name="type" value="receita" required>
        <input type="hidden" id="editTransactionId" name="id">
       </div>
       <div><label class="block text-sm font-semibold mb-2">Descrição</label>
        <div class="relative">
         <input type="text" id="editTransactionDescription" name="description" required placeholder="Ex: Salário, Aluguel, Compras" autocomplete="off" oninput="handleEditDescriptionInput(event)" onkeydown="handleEditDescriptionKeydown(event)" ontouchstart="setTouchStartX(event)">
         <div id="editDescriptionSuggestion" class="absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-green-600 rounded-lg px-3 py-2 text-sm text-gray-400 cursor-pointer hover:bg-gray-700 transition-colors hidden" onclick="acceptEditSuggestion()">
          <span id="editSuggestionText"></span>
         </div>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Valor</label>
        <div class="flex items-center gap-2"><span class="text-green-500 font-bold text-lg flex-shrink-0">R$</span> <input type="number" id="editTransactionAmount" name="amount" step="0.01" required placeholder="0,00" class="flex-1">
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Categoria</label>
        <div class="flex gap-2"><select id="editTransactionCategory" name="category" required class="flex-1"> </select> <button type="button" onclick="openCategoryModalFromTransaction()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar nova categoria">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Data</label> <input type="date" id="editTransactionDate" name="date" required>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeEditTransactionModal()">Cancelar</button> <button type="button" class="btn-secondary btn-danger" onclick="confirmDeleteEditingTransaction()" style="margin-left: auto;">Deletar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Card Modal -->
   <div id="cardModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Novo Cartão</h3><button onclick="closeCardModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="cardForm" onsubmit="saveCard(event)">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-2">Nome do Cartão</label> <input type="text" id="cardName" name="name" required placeholder="Ex: Nubank, Itaú">
       </div>
       <div><label class="block text-sm font-semibold mb-2">Tipo</label> <select id="cardType" name="type" required onchange="toggleCreditCardFields()"> <option value="debito">Débito</option> <option value="credito">Crédito</option> </select>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Últimos 4 dígitos</label> <input type="text" id="cardLast4" name="last_four" maxlength="4" pattern="[0-9]{4}" placeholder="0000">
       </div>
       <div id="creditCardFields" style="display: none;">
        <div class="space-y-4">
         <div><label class="block text-sm font-semibold mb-2">Limite (R$)</label> <input type="number" id="cardLimit" name="credit_limit" step="0.01" placeholder="0,00">
         </div>
         <div><label class="block text-sm font-semibold mb-2">Dia de Fechamento</label> <input type="number" id="closingDay" name="closing_day" min="1" max="31" placeholder="Ex: 15">
         </div>
         <div><label class="block text-sm font-semibold mb-2">Dia de Vencimento</label> <input type="number" id="dueDay" name="due_day" min="1" max="31" placeholder="Ex: 20">
         </div>
        </div>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeCardModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Edit Card Modal -->
   <div id="editCardModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Editar Cartão</h3><button onclick="closeEditCardModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="editCardForm" onsubmit="saveEditCard(event)">
      <input type="hidden" id="editCardId" name="id">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-2">Nome do Cartão</label> <input type="text" id="editCardName" name="name" required placeholder="Ex: Nubank, Itaú">
       </div>
       <div><label class="block text-sm font-semibold mb-2">Tipo</label> <select id="editCardType" name="type" required onchange="toggleEditCreditCardFields()"> <option value="debito">Débito</option> <option value="credito">Crédito</option> </select>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Últimos 4 dígitos</label> <input type="text" id="editCardLast4" name="last_four" maxlength="4" pattern="[0-9]{4}" placeholder="0000">
       </div>
       <div id="editCreditCardFields" style="display: none;">
        <div class="space-y-4">
         <div><label class="block text-sm font-semibold mb-2">Limite (R$)</label> <input type="number" id="editCardLimit" name="credit_limit" step="0.01" placeholder="0,00">
         </div>
         <div><label class="block text-sm font-semibold mb-2">Dia de Fechamento</label> <input type="number" id="editClosingDay" name="closing_day" min="1" max="31" placeholder="Ex: 15">
         </div>
         <div><label class="block text-sm font-semibold mb-2">Dia de Vencimento</label> <input type="number" id="editDueDay" name="due_day" min="1" max="31" placeholder="Ex: 20">
         </div>
        </div>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeEditCardModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Goal Modal -->
   <div id="goalModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Nova Meta</h3><button onclick="closeGoalModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="goalForm" onsubmit="saveGoal(event)">
      <div class="space-y-4">
       <div>
        <label class="block text-sm font-semibold mb-2">Nome da Meta</label>
        <input type="text" id="goalName" name="name" required placeholder="Ex: Viagem, Carro novo, Casa própria">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Descrição (Opcional)</label>
        <textarea id="goalDescription" name="description" placeholder="Ex: Viagem para Bali em 2024" rows="2" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"></textarea>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Valor Total (R$)</label>
        <input type="number" id="goalTarget" name="target_amount" step="0.01" required placeholder="0,00">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Valor Inicial (R$)</label>
        <input type="number" id="goalCurrent" name="current_amount" step="0.01" value="0" placeholder="0,00">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Data Limite (Opcional)</label>
        <input type="date" id="goalDeadline" name="deadline">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Prioridade</label>
        <select id="goalPriority" name="priority" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-green-500 focus:outline-none">
         <option value="baixa">📋 Baixa</option>
         <option value="media" selected>⭐ Média</option>
         <option value="alta">🔥 Alta</option>
        </select>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary flex-1">Criar Meta</button> <button type="button" class="btn-secondary flex-1" onclick="closeGoalModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Edit Goal Modal -->
   <div id="editGoalModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Editar Meta</h3><button onclick="closeEditGoalModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="editGoalForm" onsubmit="saveEditGoal(event)">
      <input type="hidden" id="editGoalId" name="id">
      <div class="space-y-4">
       <div>
        <label class="block text-sm font-semibold mb-2">Nome da Meta</label>
        <input type="text" id="editGoalName" name="name" required placeholder="Ex: Viagem, Carro novo, Casa própria">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Descrição (Opcional)</label>
        <textarea id="editGoalDescription" name="description" placeholder="Ex: Viagem para Bali em 2024" rows="2" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"></textarea>
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Valor Total (R$)</label>
        <input type="number" id="editGoalTarget" name="target_amount" step="0.01" required placeholder="0,00">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Valor Atual (R$)</label>
        <input type="number" id="editGoalCurrent" name="current_amount" step="0.01" value="0" placeholder="0,00">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Data Limite (Opcional)</label>
        <input type="date" id="editGoalDeadline" name="deadline">
       </div>
       <div>
        <label class="block text-sm font-semibold mb-2">Prioridade</label>
        <select id="editGoalPriority" name="priority" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-green-500 focus:outline-none">
         <option value="baixa">📋 Baixa</option>
         <option value="media">⭐ Média</option>
         <option value="alta">🔥 Alta</option>
        </select>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary flex-1">Salvar Alterações</button> <button type="button" class="btn-secondary flex-1" onclick="closeEditGoalModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Category Modal -->
   <div id="categoryModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Nova Categoria</h3><button onclick="closeCategoryModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="categoryForm" onsubmit="saveCategory(event)">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-2">Nome da Categoria</label> <input type="text" id="categoryName" name="name" required placeholder="Ex: Streaming, Pets">
       </div>
       <div><label class="block text-sm font-semibold mb-2">Tipo</label> <select id="categoryType" name="type" required> <option value="despesa">Despesa</option> <option value="receita">Receita</option> </select>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeCategoryModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Adjust Balance Modal -->
   <div id="adjustBalanceModal" class="modal">
    <div class="modal-content max-w-md">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Ajustar Saldo Total</h3><button onclick="closeAdjustBalanceModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="adjustBalanceForm" onsubmit="saveAdjustBalance(event)">
      <div class="space-y-4">
       <div>
        <label class="block text-sm font-semibold mb-2">Saldo Total</label>
        <div class="flex items-center gap-2"><span class="text-green-500 font-bold text-lg flex-shrink-0">R$</span> <input type="number" id="adjustBalanceInput" name="balance" step="0.01" required placeholder="0,00" class="flex-1">
        </div>
        <p class="text-xs text-gray-500 mt-2">Saldo Atual: <span id="currentBalanceDisplay">R$ 0,00</span></p>
       </div>
       <div class="bg-yellow-900 bg-opacity-30 border border-yellow-600 rounded-lg p-3">
        <p class="text-xs text-yellow-400">⚠️ Isso ajustará o saldo para o valor inserido. Use com cuidado!</p>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Confirmar</button> <button type="button" class="btn-secondary" onclick="closeAdjustBalanceModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Calculator Modal -->
   <div id="calculatorModal" class="modal">
    <div class="modal-content max-w-xs">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Calculadora</h3><button onclick="closeCalculator()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <div class="space-y-4">
      <div class="bg-black rounded-lg p-4 text-right">
       <div id="calcDisplay" class="text-3xl font-bold text-green-500 break-all">
        0
       </div>
      </div>
      <div class="grid grid-cols-4 gap-2"><button onclick="calcAppend('7')" class="calc-btn">7</button> <button onclick="calcAppend('8')" class="calc-btn">8</button> <button onclick="calcAppend('9')" class="calc-btn">9</button> <button onclick="calcAppend('/')" class="calc-btn calc-btn-operator">÷</button> <button onclick="calcAppend('4')" class="calc-btn">4</button> <button onclick="calcAppend('5')" class="calc-btn">5</button> <button onclick="calcAppend('6')" class="calc-btn">6</button> <button onclick="calcAppend('*')" class="calc-btn calc-btn-operator">×</button> <button onclick="calcAppend('1')" class="calc-btn">1</button> <button onclick="calcAppend('2')" class="calc-btn">2</button> <button onclick="calcAppend('3')" class="calc-btn">3</button> <button onclick="calcAppend('-')" class="calc-btn calc-btn-operator">-</button> <button onclick="calcAppend('0')" class="calc-btn">0</button> <button onclick="calcAppend('.')" class="calc-btn">.</button> <button onclick="calcClear()" class="calc-btn calc-btn-clear">C</button> <button onclick="calcAppend('+')" class="calc-btn calc-btn-operator">+</button> <button onclick="calcEquals()" class="calc-btn calc-btn-equals col-span-4">=</button> <button id="calcSendBtn" onclick="sendCalcResult()" class="calc-btn calc-btn-send col-span-4" style="display: none;">
        <svg class="inline-block mr-2" width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 8H14M14 8L10 4M14 8L10 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg> Enviar Valor </button>
      </div>
     </div>
    </div>
   </div><!-- Recurring Transaction Modal -->
   <div id="recurringModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Nova Transação Recorrente</h3><button onclick="closeRecurringModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="recurringForm" onsubmit="saveRecurring(event)">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-3">Tipo</label>
        <div class="flex gap-3"><button type="button" id="btnReceitaRecurring" onclick="selectRecurringType('receita')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-income-selected">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15V5M10 5L5 10M10 5L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Receita </button> <button type="button" id="btnDespesaRecurring" onclick="selectRecurringType('despesa')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-recurring-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M10 15L15 10M10 15L5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Despesa </button>
        </div><input type="hidden" id="recurringType" name="type" value="receita" required>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Descrição</label>
        <div class="relative">
         <input type="text" id="recurringDescription" name="description" required placeholder="Ex: Salário, Conta de Luz" autocomplete="off" oninput="handleRecurringDescriptionInput(event)" onkeydown="handleRecurringDescriptionKeydown(event)" ontouchstart="setTouchStartX(event)">
         <div id="recurringDescriptionSuggestion" class="absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-green-600 rounded-lg px-3 py-2 text-sm text-gray-400 cursor-pointer hover:bg-gray-700 transition-colors hidden" onclick="acceptRecurringSuggestion()">
          <span id="recurringSuggestionText"></span>
         </div>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Valor</label>
        <div class="flex items-center gap-2"><span class="text-green-500 font-bold text-lg">R$</span> <input type="number" id="recurringAmount" name="amount" step="0.01" required placeholder="0,00">
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Categoria</label>
        <div class="flex gap-2"><select id="recurringCategory" name="category" required class="flex-1"> </select> <button type="button" onclick="openCategoryModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar nova categoria">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="recurringCardSelectionSectionIncome" style="display: block;"><label class="block text-sm font-semibold mb-2">Depositar em (Opcional)</label>
        <div class="flex gap-2"><select id="recurringCardSelectionIncome" name="card_id_income" class="flex-1"> <option value="">Nenhum (dinheiro/outro)</option> </select> <button type="button" onclick="openCardModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="recurringCardSelectionSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Selecione o Cartão</label>
        <div class="flex gap-2"><select id="recurringCardSelection" name="card_id" class="flex-1"> <option value="">Selecione um cartão</option> </select> <button type="button" onclick="openCardModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Data de Início</label> <input type="date" id="recurringStartDate" name="start_date" required>
        <p class="text-xs text-gray-400 mt-1">A partir de quando a recorrência deve começar</p>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Dia do Mês</label> <input type="number" id="recurringDay" name="day_of_month" min="1" max="31" required placeholder="Ex: 5, 10, 15">
        <p class="text-xs text-gray-400 mt-1">A transação será criada automaticamente todo dia especificado</p>
       </div>
       <div><label class="block text-sm font-semibold mb-3">Duração</label>
        <div class="flex gap-3"><button type="button" id="btnPermanent" onclick="selectRecurringDuration('permanent')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold btn-duration btn-permanent-selected"> ♾️ Permanente </button> <button type="button" id="btnTemporary" onclick="selectRecurringDuration('temporary')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold btn-duration"> 📅 Temporária </button>
        </div><input type="hidden" id="recurringDuration" name="duration_type" value="permanent" required>
       </div>
       <div id="durationMonthsSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Duração (meses)</label> <input type="number" id="durationMonths" name="duration_months" min="1" placeholder="Ex: 6, 12">
        <p class="text-xs text-gray-400 mt-1">Após este período, a recorrência será automaticamente desativada</p>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeRecurringModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div><!-- Edit Recurring Modal -->
   <div id="editRecurringModal" class="modal">
    <div class="modal-content">
     <div class="flex items-center justify-between mb-6">
      <h3 class="text-2xl font-bold">Editar Transação Recorrente</h3><button onclick="closeEditRecurringModal()" class="text-gray-400 hover:text-white">
       <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
       </svg></button>
     </div>
     <form id="editRecurringForm" onsubmit="saveEditRecurring(event)">
      <input type="hidden" id="editRecurringId" name="id">
      <div class="space-y-4">
       <div><label class="block text-sm font-semibold mb-3">Tipo</label>
        <div class="flex gap-3"><button type="button" id="editBtnReceitaRecurring" onclick="selectEditRecurringType('receita')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-income-selected">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 15V5M10 5L5 10M10 5L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Receita </button> <button type="button" id="editBtnDespesaRecurring" onclick="selectEditRecurringType('despesa')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold flex items-center justify-center gap-2 btn-recurring-type">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M10 15L15 10M10 15L5 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> Despesa </button>
        </div><input type="hidden" id="editRecurringType" name="type" value="receita" required>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Descrição</label>
        <div class="relative">
         <input type="text" id="editRecurringDescription" name="description" required placeholder="Ex: Salário, Conta de Luz" autocomplete="off" oninput="handleEditRecurringDescriptionInput(event)" onkeydown="handleEditRecurringDescriptionKeydown(event)" ontouchstart="setTouchStartX(event)">
         <div id="editRecurringDescriptionSuggestion" class="absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-green-600 rounded-lg px-3 py-2 text-sm text-gray-400 cursor-pointer hover:bg-gray-700 transition-colors hidden" onclick="acceptEditRecurringSuggestion()">
          <span id="editRecurringSuggestionText"></span>
         </div>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Valor</label>
        <div class="flex items-center gap-2"><span class="text-green-500 font-bold text-lg">R$</span> <input type="number" id="editRecurringAmount" name="amount" step="0.01" required placeholder="0,00">
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Categoria</label>
        <div class="flex gap-2"><select id="editRecurringCategory" name="category" required class="flex-1"> </select> <button type="button" onclick="openCategoryModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar nova categoria">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="editRecurringCardSelectionSectionIncome" style="display: block;"><label class="block text-sm font-semibold mb-2">Depositar em (Opcional)</label>
        <div class="flex gap-2"><select id="editRecurringCardSelectionIncome" name="card_id_income" class="flex-1"> <option value="">Nenhum (dinheiro/outro)</option> </select> <button type="button" onclick="openCardModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div id="editRecurringCardSelectionSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Selecione o Cartão</label>
        <div class="flex gap-2"><select id="editRecurringCardSelection" name="card_id" class="flex-1"> <option value="">Selecione um cartão</option> </select> <button type="button" onclick="openCardModalFromRecurring()" class="px-3 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white font-semibold transition-colors flex items-center justify-center" title="Adicionar novo cartão">
          <svg width="20" height="20" viewbox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 5V15M5 10H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg></button>
        </div>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Data de Início</label> <input type="date" id="editRecurringStartDate" name="start_date" required>
        <p class="text-xs text-gray-400 mt-1">A partir de quando a recorrência deve começar</p>
       </div>
       <div><label class="block text-sm font-semibold mb-2">Dia do Mês</label> <input type="number" id="editRecurringDay" name="day_of_month" min="1" max="31" required placeholder="Ex: 5, 10, 15">
        <p class="text-xs text-gray-400 mt-1">A transação será criada automaticamente todo dia especificado</p>
       </div>
       <div><label class="block text-sm font-semibold mb-3">Duração</label>
        <div class="flex gap-3"><button type="button" id="editBtnPermanent" onclick="selectEditRecurringDuration('permanent')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold btn-duration btn-permanent-selected"> ♾️ Permanente </button> <button type="button" id="editBtnTemporary" onclick="selectEditRecurringDuration('temporary')" class="flex-1 py-3 px-4 rounded-lg border-2 transition-all font-semibold btn-duration"> 📅 Temporária </button>
        </div><input type="hidden" id="editRecurringDuration" name="duration_type" value="permanent" required>
       </div>
       <div id="editDurationMonthsSection" style="display: none;"><label class="block text-sm font-semibold mb-2">Duração (meses)</label> <input type="number" id="editDurationMonths" name="duration_months" min="1" placeholder="Ex: 6, 12">
        <p class="text-xs text-gray-400 mt-1">Após este período, a recorrência será automaticamente desativada</p>
       </div>
       <div class="flex gap-3 pt-4"><button type="submit" class="btn-primary">Salvar</button> <button type="button" class="btn-secondary" onclick="closeEditRecurringModal()">Cancelar</button>
       </div>
      </div>
     </form>
    </div>
   </div>
  </div>
  <script src="main.js"></script>
</body>
</html>